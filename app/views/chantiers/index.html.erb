<div class="O_page">
  <h1 class="SD_title">Suivi des risques</h1>
    <h1 class="SD_subtitle">Dernière mise à jour : 22 novembre 2020</h1>
  <div class="SD-table-box">
    <div class="SD-topo-box-title">
            <span>Chiffres</span>
    </div><br><br>
    <div class="risques-actu-text">Aujourd'hui il existe : </div>
    <div class="risques-actu-box">
      <div class="risques-actu-infos"><span><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 5).count %></span> risques critiques</div>
      <div class="risques-actu-infos"><span><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 4).count %></span> risques importants</div>
      <div class="risques-actu-infos"><span><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 3).count %></span> risques modérés</div>
      <div class="risques-actu-infos"><span><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 2).count %></span> risques faibles</div>
    </div>
    <br><br>
    <div class="SD-topo-box-title">
            <span>Risques actuels</span>
    </div><br><br>
    <div class="risques-infos-title-box" > 
         <div class="risques-infos-title-hr">
           <hr>
         </div>
         <div class="risques-infos-title" > 
         Risques critiques <br>(Fin > Date JOP)
         </div>
          <div class="risques-infos-title-hr">
           <hr>
         </div>
      </div>
    <% if OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 5).count > 0 %>
    <% OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 5).each do |revue| %>
    <div class="risque-infos-line" >
      <div class="risque-infos-name"><span class='critique'><i class="fas fa-exclamation-circle"></i></span> <%= link_to ouvrage_path(Ouvrage.find(revue.ouvrage_id)) do %><%= revue.ouvrage.name %><% end %></div>
      <div class="risque-infos-date">Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%> </div>
      <div class="risque-infos-text">Retard : <%= revue.delai_time.to_i %> mois </div>
      <div class="risque-infos-moa">MOA : <%= revue.ouvrage.maitre_oeuvre %></div>
  
    </div>
    <% end %>
    <% end %>
    <br>
       <div class="risques-infos-title-box" > 
         <div class="risques-infos-title-hr">
           <hr>
         </div>
         <div class="risques-infos-title" > 
         Risques importants <br>(Décalage > 6 mois)
         </div>
          <div class="risques-infos-title-hr">
           <hr>
         </div>
      </div>
     <% if OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 4).count > 0 %>
    <% OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 4).each do |revue| %>
     <div class="risque-infos-line" >
      <div class="risque-infos-name"><span class='important'><i class="fas fa-exclamation-circle"></i></span><%= link_to ouvrage_path(Ouvrage.find(revue.ouvrage_id)) do %><%= revue.ouvrage.name %><% end %></div>
      <div class="risque-infos-date">Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%> </div>
      <div class="risque-infos-text">Retard : <%= revue.delai_time.to_i %> mois </div>
      <div class="risque-infos-moa">MOA : <%= revue.ouvrage.maitre_oeuvre %></div>
    </div>
   <% end %>
    <% end %>
    <br>
    
    <div class="risques-infos-title-box" > 
         <div class="risques-infos-title-hr">
           <hr>
         </div>
         <div class="risques-infos-title" > 
        Risques modérés <br>(Décalage : 3-6 mois)
         </div>
          <div class="risques-infos-title-hr">
           <hr>
         </div>
      </div>
       <% if OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 3).count > 0 %>
    <% OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 3).each do |revue| %>
     <div class="risque-infos-line" >
      <div class="risque-infos-name"><span class='modere'><i class="fas fa-exclamation-circle"></i></span> <%= link_to ouvrage_path(Ouvrage.find(revue.ouvrage_id)) do %><%= revue.ouvrage.name %><% end %></div>
      <div class="risque-infos-date">Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%> </div>
      <div class="risque-infos-text">Retard : <%= revue.delai_time.to_i %> mois </div>
      <div class="risque-infos-moa">MOA : <%= revue.ouvrage.maitre_oeuvre %></div>
    </div>
    <% end %>
    <% end %>
    <br>
    <div class="risques-infos-title-box" > 
         <div class="risques-infos-title-hr">
           <hr>
         </div>
         <div class="risques-infos-title" > 
        Risques faibles <br>(Décalage < 6 mois)
         </div>
          <div class="risques-infos-title-hr">
           <hr>
         </div>
      </div>
      <% if OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 2).count > 0 %>
    <% OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 2).each do |revue| %>
     <div class="risque-infos-line" >
      <div class="risque-infos-name"><span class='faible'><i class="fas fa-exclamation-circle"></i></span> <%= link_to ouvrage_path(Ouvrage.find(revue.ouvrage_id)) do %><%= revue.ouvrage.name %><% end %></div>
      <div class="risque-infos-date">Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%> </div>
      <div class="risque-infos-text">Retard : <%= revue.delai_time.to_i %> mois </div>
      <div class="risque-infos-moa">MOA : <%= revue.ouvrage.maitre_oeuvre %></div>
    </div>
      <% end %>
      <% end %>
  </div>
  <br><br>
  

</div>

<script>

  $('.menu-solideo-chantiers').addClass('menu-active2'); 
  $('.menu-ouvrages').addClass('menu-active'); 

  $('#MonCollapse3').addClass('in'); 

</script>
