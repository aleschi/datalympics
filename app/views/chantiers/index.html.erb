<div class="O_page">
  <h1 class="SD_title SD_title2">Suivi des risques</h1>
    <h1 class="SD_subtitle">Dernière mise à jour : 22 février 2020</h1>
  <div class="SD-table-box">
    <div class="SD-topo-box-title">
            <span>Chiffres</span>
    </div><br><br>
    <div class="risques-actu-text">Aujourd'hui il existe : </div>
    <div class="visible-xs">
      <div class="ouvrages-budget-infos">
      <div class="calendar-infos-box">     
        <div class="risques-actu-number"><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 5).count %></div>               <div><span>risques <br>critiques</span></div>
      </div>
      </div>
      <div class="ouvrages-budget-infos">
      <div class="calendar-infos-box">  
        <div class="risques-actu-number"><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 4).count %></div>               <div><span>risques <br>importants</span></div>
        </div>
      </div>
      <div class="ouvrages-budget-infos">
     <div class="calendar-infos-box"> 
       <div class="risques-actu-number"><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 3).count %></div>
       <div><span>risques<br>modérés</span></div>
          </div>
      </div>
      <div class="ouvrages-budget-infos">
      <div class="calendar-infos-box">  
        <div class="risques-actu-number"><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 2).count %></div>
        <div><span>risques <br>faibles</span></div>
    </div>
          </div>
    </div>
    <div class="ouvrages-budget-infos-box hidden-xs">
      <div class="ouvrages-budget-infos">
      <div class="calendar-infos-box">     
        <div class="risques-actu-number"><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 5).count %></div>               <div><span>risques <br>critiques</span></div>
      </div>
      </div>
      <div class="ouvrages-budget-infos">
      <div class="calendar-infos-box">  
        <div class="risques-actu-number"><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 4).count %></div>               <div><span>risques <br>importants</span></div>
        </div>
      </div>
      <div class="ouvrages-budget-infos">
     <div class="calendar-infos-box"> 
       <div class="risques-actu-number"><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 3).count %></div>
       <div><span>risques<br>modérés</span></div>
          </div>
      </div>
      <div class="ouvrages-budget-infos">
      <div class="calendar-infos-box">  
        <div class="risques-actu-number"><%= OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 2).count %></div>
        <div><span>risques <br>faibles</span></div>
    </div>
          </div>
    </div>
    <br><br>
    <div class="SD-topo-box-title">
            <span>Risques actuels</span>
    </div><br><br>
    <div class="risques-infos-title-box" > 
         <div class="risques-infos-title-hr">
           <hr>
         </div>
         <div class="risques-infos-title" > 
         Risques critiques <br>(Fin > Date JOP)
         </div>
          <div class="risques-infos-title-hr">
           <hr>
         </div>
      </div>
    <% if OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 5).count > 0 %>
 
  <div class="ED_table ED_table-riques">
    <table class="table-striped">
      <tbody> 
           <% OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 5).each do |revue| %>
        <tr>
            <td class="risque-infos-name"><span class='critique'><i class="fas fa-exclamation-triangle"></i></span> <%= link_to ouvrage_path(Ouvrage.find(revue.ouvrage_id)) do %><%= revue.ouvrage.name %> <% end %>
            <div class="visible-xs">Retard : <%= revue.delai_time.to_i %> mois</div>
            <div class="visible-xs"><em>Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%></em></div>
            
          </td>
            <td class="hidden-xs">Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%></td>
            <td class="hidden-xs">Retard : <%= revue.delai_time.to_i %> mois </td>
            <td class="hidden-sm hidden-xs">MOA : <%= revue.ouvrage.maitre_oeuvre %></td>
          
        </tr>
         <% end %>
      </tbody>
    </table>
    </div>

   
    <% end %>
    <br>
       <div class="risques-infos-title-box" > 
         <div class="risques-infos-title-hr">
           <hr>
         </div>
         <div class="risques-infos-title" > 
         Risques importants <br>(Décalage > 6 mois)
         </div>
          <div class="risques-infos-title-hr">
           <hr>
         </div>
      </div>
     <% if OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 4).count > 0 %>

    <div class="ED_table ED_table-riques">
    <table class="table-striped">
      <tbody> 
            <% OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 4).each do |revue| %>
        <tr>
            <td class="risque-infos-name"><span class='important'><i class="fas fa-exclamation-triangle"></i></span> <%= link_to ouvrage_path(Ouvrage.find(revue.ouvrage_id)) do %><%= revue.ouvrage.name %> <% end %>
              <div class="visible-xs">Retard : <%= revue.delai_time.to_i %> mois</div>
              <div class="visible-xs"><em>Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%></em></div>
      
          </td>
            <td class="hidden-xs">Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%></td>
            <td class="hidden-xs">Retard : <%= revue.delai_time.to_i %> mois </td>
            <td class="hidden-sm hidden-xs">MOA : <%= revue.ouvrage.maitre_oeuvre %></td>
          
        </tr>  
          <% end %>
      </tbody>
    </table>
    </div>
    
 
    <% end %>
    <br>
    
    <div class="risques-infos-title-box" > 
         <div class="risques-infos-title-hr">
           <hr>
         </div>
         <div class="risques-infos-title" > 
        Risques modérés <br>(Décalage : 3-6 mois)
         </div>
          <div class="risques-infos-title-hr">
           <hr>
         </div>
      </div>
       <% if OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 3).count > 0 %>

    <div class="ED_table ED_table-riques">
    <table class="table-striped">
      <tbody>
            <% OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 3).each do |revue| %>
        <tr>
            <td class="risque-infos-name"><span class='modere'><i class="fas fa-exclamation-triangle"></i></span> <%= link_to ouvrage_path(Ouvrage.find(revue.ouvrage_id)) do %><%= revue.ouvrage.name %> <% end %>
              <div class="visible-xs">Retard : <%= revue.delai_time.to_i %> mois</div>
          <div class="visible-xs"><em>Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%></em></div>
         
          </td>
            <td class="hidden-xs">Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%></td>
            <td class="hidden-xs">Retard : <%= revue.delai_time.to_i %> mois </td>
            <td class="hidden-sm hidden-xs">MOA : <%= revue.ouvrage.maitre_oeuvre %></td>
          
        </tr> 
         <% end %>
      </tbody>
    </table>
    </div>
    
   
    <% end %>
    <br>
    <div class="risques-infos-title-box" > 
         <div class="risques-infos-title-hr">
           <hr>
         </div>
         <div class="risques-infos-title" > 
        Risques faibles <br>(Décalage < 3 mois)
         </div>
          <div class="risques-infos-title-hr">
           <hr>
         </div>
      </div>
      <% if OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 2).count > 0 %>
    
      <div class="ED_table ED_table-riques">
    <table class="table-striped">
      <tbody> 
        <% OuvragesRevue.where('date = ? AND delai_indicateur = ?', OuvragesRevue.order('date DESC').first.date, 2).each do |revue| %>
        <tr>
            <td class="risque-infos-name"><span class='faible'><i class="fas fa-exclamation-triangle"></i></span> <%= link_to ouvrage_path(Ouvrage.find(revue.ouvrage_id)) do %><%= revue.ouvrage.name %> <% end %>
              <div class="visible-xs">Retard : <%= revue.delai_time.to_i %> mois</div>
          <div class="visible-xs"><em>Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%></em></div>
              
          </td>
            <td class="hidden-xs">Dernière MAJ : <%= l(revue.date_maj, :format => '%B %Y')%></td>
            <td class="hidden-xs">Retard : <%= revue.delai_time.to_i %> mois </td>
            <td class="hidden-sm hidden-xs">MOA : <%= revue.ouvrage.maitre_oeuvre %></td>
          
        </tr> 
         <% end %>
      </tbody>
    </table>
    </div>
     
     
      <% end %>
  </div>
  <br><br>
  

</div>

<script>

  $('.menu-solideo-chantiers').addClass('menu-active2'); 
  $('.menu-ouvrages').addClass('menu-active'); 

  $('#MonCollapse3').addClass('in'); 

</script>
