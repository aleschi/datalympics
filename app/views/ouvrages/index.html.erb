<div class="SD_page">
  <div class="SD_home_button">
    <%= link_to root_path do %><i class="fas fa-chevron-left"></i><i class="fas fa-home"></i>Retour accueil<%end %>
  </div>
  <h1 class="O_title"><span>Ouvrages</span></h1>
  <div class="SF-topo-box">
     <div class="SF-topo-financeurs">
      <% if !@ouvrages.nil?%>
      <% @ouvrages.each do |ouvrage| %>
        <div class="O-name">
        <%= link_to ouvrage do %>
          <%= ouvrage.name %>  <span>- <%= number_with_delimiter(ouvrage.budget.to_i, :delimiter => ' ')%> €</span>        
        <% end %>
        </div>
      <% end %>
      <% end %>
    </div>


    <div class="topo-chart width-50">
      <div>
      <%= pie_chart @ouvrages.unscope(:order).group(:name).sum(:budget), library: {
       chart: {
         backgroundColor: '#F3F8FF',
          type: 'pie',
          options3d: {
              enabled: true,
              alpha: 45
          },
         style:{
            fontFamily: "Spectral",
            },
      },

        title: {
          text:'<em>Répartition des dépenses prévues des ouvrages <br> Total : 1 382 775 000 €</em>',
          margin:40,
          style: {
            color: '#8F8F8F',

            }
        },

       plotOptions: {
          pie: {
              innerSize: 140,
              minSize: 400,
              depth: 45,

              dataLabels: {
                      enabled: true,
                     # format: '<em> {point.percentage:.1f} %</em>',
                      style: {
                        color: "#8F8F8F",
                        fontSize: "12px",
                        fontWeight: "400",

                        }
                  }
          }
      },
      tooltip:{  
           pointFormat: '<span style="color:{point.color}">●</span> Total: <b>{point.y:,.0f}€</b><br/>',  
      },
    }

      %>
        
      </div><br><br>
      
      <div>
        <%= bar_chart [ {name: "Total prévu", data: [["Total",1382775000]]}, {name: "Total actuel", data: [["Total", OuvragesDepense.all.sum('montant').to_i]]} ], library: {
      chart: {
          backgroundColor: '#F3F8FF',
         inverted: true,
      
     
      type: 'bar', 
          style:{
          fontFamily: "Spectral",
          maxWidth: "500px",
          }
        },
      colors: ["#8F8F8F", "#48AF5C"],
   yAxis: {
        gridLineColor: '#F3F8FF', 
     title: {
       text: "% atteint du budget total prévu des ouvrages "
       }
       },

       plotOptions: {
          bar: {
             pointWidth: 10,
            stacking: 'percent',
             label: { 
              enable: false,
               },
            },
         },
       
       
      } %>
      </div>

    </div>
  </div>

<br><br>

 <div class="EB-details">
    <%= link_to "En savoir plus sur les dépenses des ouvrages" , ouvrages_depenses_path %>
    </div>


</div>
