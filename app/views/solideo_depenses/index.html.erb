<% if !SolideoStructureDepense.last.nil?%>
<div class="page_w">
  <div class="i24"></div>
  <div class="titre_page text-center">Suivi du budget</div>
  <div class="i12"></div>
  <div class="stitre_page text-center">Dernière mise à jour : <%= l(SolideoStructureDepense.order(date: :asc).last.date, format: "%e %B %Y") %></div>
  <div class="i40"></div>
  
<div class="box_page">
  <div><span class="titre_section">Exécution budgétaire depuis 2018 (€ courant)</span></div>
  <div class="i24"></div>
  <div class="box-erreur">Des données financières sont potentiellement manquantes ou inexactes </div>
  <div class="i24"></div>
  <div class="i24"></div>
  <div class="row">
    <div class="col-md-4 col-sm-5 col-xs-12"> 
      <div id="depenses_totales" style="height:150px;overflow:hidden;"></div>
      <div class="box_i1">
            <div class="box_i1_t1"><%= number_with_delimiter(SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('montants_engages_cumul').round(1), :delimiter => ' ') %> M€</div>
            <div class="box_i1_t2">Total des montants engagés</div>
      </div>
    </div>
   
    <div class="col-md-8 col-sm-7 col-xs-12">
      <div id="container-bar1"></div>
      
    </div>    
  </div>
  <div class="i60"></div>
  <div class="row">
        <div class="col-md-4 col-sm-4 col-xs-6">
        <div id="pie-ouvrages"></div> 
        </div>
        <div class="col-md-4 col-sm-4 col-xs-6">
        <div id="pie-ouvrages-hs"></div> 
        </div>
        <div class="col-md-4 col-sm-4 col-xs-12">
          <div class="box_i1">
            <div class="box_i1_t1">FONCTIONNEMENT</div>
            <div class="box_i1_t2"><%= @droits_constates_f.round(1)%>M€/<%=@budget_f.round(1)%>M€ consommés</div>
          </div>
          <div class="i32"></div>
          <div class="box_i1">
            <div class="box_i1_t1">RÉSERVE ET INNOVATION</div>
            <div class="box_i1_t2"><%=@droits_constates_ri.round(1)%>M€/<%=@budget_ri.round(1)%>M€ consommés</div>
          </div>
        </div>
  </div>
  <div class="i40"></div>
  <div class="flexslider2">
    <ul class="slides">
    <% @dates_depenses_reporting.each_with_index do |date,i|%>

    <li> 
      <div class="ga ma pr">
        <div class="modal_title text-center"><%= l(date, format: "%e %B %Y") %></div>
        <div class='i24'></div>
        <div class="row w100 margin-none">
          <div class="col-md-12 col-sm-12 col-xs-12">
            <div id="ouvrages<%=i%>"></div>
            <div class="i8"></div>
          </div>
        </div>
      </div>
        
    <script>
      var chart<%=i%> = Highcharts.chart('ouvrages<%=i%>', {
        chart: {
            type: 'column',
            marginTop:40,
           
            marginRight:0,
            marginLeft:0,
            height:300,
            spacing: [0,0,0,0],
            backgroundColor: '#fff',
            style:{
              fontFamily: "Marianne Regular",
         
              },
        },
        title: {
            text: 'Suivi des droits constatés (cumul depuis le début)',
            verticalAlign: "top",
            style: {
                color: "#6A6A6A",
                fontWeight: "400",        
                fontSize: '12px',
                  },
          },

        xAxis: {
            categories: ["Ouvrages MOA Solideo", "Ouvrages hors MOA SOLIDEO", "Fonctionnement", "Réserve et Innovation", "Total"],
            crosshair: true,
            labels: {
                formatter: function () {
                  if (this.value == "Dépenses 2018" || this.value == "Dépenses 2019" || this.value == "Dépenses 2020" ){
                    return '<span style="color:#E1000F;">' + this.value + '</span>'
                  } else {
                    return this.value 
                  }
                },
                useHTML: true,
            },
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Budget Consommé (M€)'
            },
          gridLineColor: "#fff",
        },
      legend: {
        enabled: false,
      },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><br>',
            pointFormat: '<span style="padding:0"><b> {point.y:.1f} M€</b></span>',
  
            shared: true,
            useHTML: true,
            borderColor: 'transparent',
            borderRadius: 16,
            backgroundColor: '#fff',
        },
        plotOptions: {
            column: {
              pointWidth: 30,
                pointPadding: 0.2,
                borderWidth: 0,
                grouping: false,
              
            }
        },
        series: [{
            name: 'Droits constatés',
            data: [
            
            {y:<%=SolideoStructureDepense.where(solideo_structure_id: @list_structure_moas).where('date = ?',date).sum('droits_constates_cumul').round(1)%>, color: "#2E5D63",dataLabels: {
                    enabled: true,
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where(solideo_structure_id: @list_structure_moas).where('date = ?',date).sum('droits_constates_cumul')-SolideoStructureDepense.where(solideo_structure_id: @list_structure_moas).where('date = ?',date-1.month).sum('droits_constates_cumul')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + ' </span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + '</b>';

                      return header + content;
                    },
                },},
            {y:<%=SolideoStructureDepense.where(solideo_structure_id: @list_structure_moahs).where('date = ?',date).sum('droits_constates_cumul').round(1)%>, color: "#bfbfbf",dataLabels: {
                    enabled: true,
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where(solideo_structure_id: @list_structure_moahs).where('date = ?',date).sum('droits_constates_cumul')-SolideoStructureDepense.where(solideo_structure_id: @list_structure_moahs).where('date = ?',date-1.month).sum('droits_constates_cumul')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + ' </b>';

                      return header + content;
                    },
                },},
            {y:<%=SolideoStructureDepense.where(solideo_structure_id: @list_structure_f).where('date = ?',date).sum('droits_constates_cumul').round(1)%>, color: "#2E5D63",dataLabels: {
                    enabled: true,
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where(solideo_structure_id: @list_structure_f).where('date = ?',date).sum('droits_constates_cumul')-SolideoStructureDepense.where(solideo_structure_id: @list_structure_f).where('date = ?',date-1.month).sum('droits_constates_cumul')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + ' </b>';

                      return header + content;
                    },
                },},
            {y:<%=SolideoStructureDepense.where(solideo_structure_id: @list_structure_ri).where('date = ?',date).sum('droits_constates_cumul').round(1)%>, color: "#7D4E5B",dataLabels: {
                    enabled: true,
                    inside: false,
                    crop:false,
                    overflow:'allow',
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where(solideo_structure_id: @list_structure_ri).where('date = ?',date).sum('droits_constates_cumul')-SolideoStructureDepense.where(solideo_structure_id: @list_structure_ri).where('date = ?',date-1.month).sum('droits_constates_cumul')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + ' </b>';

                      return header + content;
                    },
                },},
            {y:<%=SolideoStructureDepense.where('date = ?',date).sum('droits_constates_cumul').round(1)%>, color: "#FFE800",dataLabels: {
                    enabled: true,
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where('date = ?',date).sum('droits_constates_cumul')-SolideoStructureDepense.where('date = ?',date-1.month).sum('droits_constates_cumul')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + ' </b>';

                      return header + content;
                    },
                },}],
            pointPlacement: 0,
        }]
      });
      if ($(window).width() > 992) {
        chart<%=i%>.update({
          chart: {width:800,},
        })
      }
    </script> 
    </li>
    <% end %>
    </ul>
  </div>

</div>
<div class="i24"></div>
<div class="box_page">
  <div>
        <span class="titre_section">Exécution budgétaire 2021</span>
  </div>
  <div class="i24"></div>
  <div class="i24"></div>
  <div class="row">
    <div class="col-md-4 col-sm-5 col-xs-12"> 
      <div id="depenses_2021" style="height:150px;overflow:hidden;"></div>
      <div class="box_i1">
            <div class="box_i1_t1">XX M€</div>
            <div class="box_i1_t2">Montants engagés 2021?</div>
      </div>
    </div>
   
    <div class="col-md-8 col-sm-7 col-xs-12">
      <div class="row">
        <div class="col-md-4 col-sm-4 col-xs-6">
        <div id="pie-ouvrages-annee"></div> 
        </div>
        <div class="col-md-4 col-sm-4 col-xs-6">
          <div id="pie-ouvrages-hs-annee"></div> 
        </div>
        <div class="col-md-4 col-sm-4 col-xs-12">
          <div class="box_i1">
            <div class="box_i1_t1">FONCTIONNEMENT</div>
            <div class="box_i1_t2"><%= @droits_constates_f_annee.round(1)%>M€/<%=@budget_f_annee.round(1)%>M€ consommés</div>
          </div>
          <div class="i32"></div>
          <div class="box_i1">
            <div class="box_i1_t1">RÉSERVE ET INNOVATION</div>
            <div class="box_i1_t2"><%=@droits_constates_ri_annee.round(1)%>M€/<%=@budget_ri_annee.round(1)%>M€ consommés</div>
          </div>
        </div>
      </div>
    </div>    
  </div>
  <div class="i40"></div>
  <div class="flexslider2">
    <ul class="slides">
    <% @dates_depenses_reporting.each_with_index do |date,i|%>

    <li> 
      <div class="ga ma pr">
        <div class="modal_title text-center"><%= l(date, format: "%e %B %Y") %></div>
        <div class='i24'></div>
        <div class="row w100 margin-none">
          <div class="col-md-12 col-sm-12 col-xs-12">
            <div id="droits_annee<%=i%>"></div>
            <div class="i8"></div>
          </div>
        </div>
      </div>
        
    <script>
      var chart<%=i%> = Highcharts.chart('droits_annee<%=i%>', {
        chart: {
            type: 'column',
            marginTop:40,
           
            marginRight:0,
            marginLeft:0,
            height:300,
            spacing: [0,0,0,0],
            backgroundColor: '#fff',
            style:{
              fontFamily: "Marianne Regular",
         
              },
        },
        title: {
            text: 'Suivi des droits constatés (cumul depuis Janvier 2021)',
            verticalAlign: "top",
            style: {
                color: "#6A6A6A",
                fontWeight: "400",        
                fontSize: '12px',
                  },
          },

        xAxis: {
            categories: ["Ouvrages MOA Solideo", "Ouvrages hors MOA SOLIDEO", "Fonctionnement", "Réserve et Innovation", "Total"],
            crosshair: true,
            labels: {
                formatter: function () {
                  if (this.value == "Dépenses 2018" || this.value == "Dépenses 2019" || this.value == "Dépenses 2020" ){
                    return '<span style="color:#E1000F;">' + this.value + '</span>'
                  } else {
                    return this.value 
                  }
                },
                useHTML: true,
            },
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Budget Consommé (M€)'
            },
          gridLineColor: "#fff",
        },
      legend: {
        enabled: false,
      },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><br>',
            pointFormat: '<span style="padding:0"><b> {point.y:.1f} M€</b></span>',
  
            shared: true,
            useHTML: true,
            borderColor: 'transparent',
            borderRadius: 16,
            backgroundColor: '#fff',
        },
        plotOptions: {
            column: {
              pointWidth: 30,
                pointPadding: 0.2,
                borderWidth: 0,
                grouping: false,
              
            }
        },
        series: [{
            name: 'Droits constatés 2021',
            data: [
            
            {y:<%=SolideoStructureDepense.where(solideo_structure_id: @list_structure_moas).where('date = ?',date).sum('droits_constates_annee').round(1)%>, color: "#2E5D63",dataLabels: {
                    enabled: true,
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where(solideo_structure_id: @list_structure_moas).where('date = ?',date).sum('droits_constates_annee')-SolideoStructureDepense.where(solideo_structure_id: @list_structure_moas).where('date = ?',date-1.month).sum('droits_constates_annee')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + ' </span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + '</b>';

                      return header + content;
                    },
                },},
            {y:<%=SolideoStructureDepense.where(solideo_structure_id: @list_structure_moahs).where('date = ?',date).sum('droits_constates_annee').round(1)%>, color: "#bfbfbf",dataLabels: {
                    enabled: true,
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where(solideo_structure_id: @list_structure_moahs).where('date = ?',date).sum('droits_constates_annee')-SolideoStructureDepense.where(solideo_structure_id: @list_structure_moahs).where('date = ?',date-1.month).sum('droits_constates_annee')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + ' </b>';

                      return header + content;
                    },
                },},
            {y:<%=SolideoStructureDepense.where(solideo_structure_id: @list_structure_f).where('date = ?',date).sum('droits_constates_annee').round(1)%>, color: "#2E5D63",dataLabels: {
                    enabled: true,
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where(solideo_structure_id: @list_structure_f).where('date = ?',date).sum('droits_constates_annee')-SolideoStructureDepense.where(solideo_structure_id: @list_structure_f).where('date = ?',date-1.month).sum('droits_constates_annee')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + ' </b>';

                      return header + content;
                    },
                },},
            {y:<%=SolideoStructureDepense.where(solideo_structure_id: @list_structure_ri).where('date = ?',date).sum('droits_constates_annee').round(1)%>, color: "#7D4E5B",dataLabels: {
                    enabled: true,
                    inside: false,
                    crop:false,
                    overflow:'allow',
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where(solideo_structure_id: @list_structure_ri).where('date = ?',date).sum('droits_constates_annee')-SolideoStructureDepense.where(solideo_structure_id: @list_structure_ri).where('date = ?',date-1.month).sum('droits_constates_annee')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + ' </b>';

                      return header + content;
                    },
                },},
            {y:<%=SolideoStructureDepense.where('date = ?',date).sum('droits_constates_annee').round(1)%>, color: "#FFE800",dataLabels: {
                    enabled: true,
                    formatter: function() {

                      var point = this;                      
                      ecart = <%=(SolideoStructureDepense.where('date = ?',date).sum('droits_constates_annee')-SolideoStructureDepense.where('date = ?',date-1.month).sum('droits_constates_annee')).round(1)%>;
                      
                      number = Highcharts.numberFormat(point.y, -1, ',',' ');
                      
                       if (ecart >= 0){
                          header = '<span style="font-size: 10px;color:#2323EA"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '<span style="font-size: 10px;color:#E1000F">' + ecart  + '</span><br/>';
                        }
                        
                        content = '<b>' + number  + ' </b>';

                      return header + content;
                    },
                },}],
            pointPlacement: 0,
        }]
      });
      if ($(window).width() > 992) {
        chart<%=i%>.update({
          chart: {width:800,},
        })
      }
    </script> 
    </li>
    <% end %>
    </ul>
  </div>
</div>

  <div id="table_filtres">
    <%= render 'table'%> 
    
 </div>


</div>

<!-- droits constates global -->
<script>
    
    Highcharts.chart('depenses_totales', {
    chart: {
        type: 'solidgauge',
        height: '200px',
          spacingTop: 0,
          style:{
            fontFamily: "Marianne Regular",
          },
    },
    title: {
        text: 'Droits constatés depuis 2018',
        verticalAlign: "top",
        style: {
                color: "#6A6A6A",
                fontWeight: "400",        
              fontSize: '12px',
                  },
       
    },
    pane: {
        //center: ['50%', '50%'],
        size: '100%',
        startAngle: -90,
        endAngle: 90,
        background: {
            backgroundColor:'#C4C4C4',
            innerRadius: '80%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },

    exporting: {
        enabled: false
    },

    tooltip: {
        enabled: false
    },

    // the value axis
    yAxis: {
        stops: [
            [0.1, '#2323EA'], // green
            [0.5, '#2323EA'], // yellow
            [0.9, '#2323EA'] // red
        ],
        lineWidth: 0,
        tickWidth: 0,
        minorTickInterval: null,
        tickAmount: 2,
        tickPositions: [<%= SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_cumul').round(1) %>, <%= SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_global').round(1) %>],
        min: <%= SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_cumul').round(1)%>,
        max: <%= SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_global').round(1) %>,
        startOnTick:true,
        title: {
          text: null,
            y: 100,
        },
        labels: {
            y: 16,
            format: '{value:.0f}M€',
        }
    },

    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: 5,
                borderWidth: 0,
                useHTML: true
            }
        }
    },

    credits: {
        enabled: false
    },
    series: [{
        name: 'Droits constatés',
        data: [<%= SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_cumul').round(1) + (SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_cumul')/SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_global'))*(SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_global')-SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_cumul')).round(1)%>],
        innerRadius: '80%',
      
        dataLabels: {
          enabled: true,
          y:-40,
            format:
                '<div style="text-align:center;color:#000;">' +
                '<span style="font-size:20px">'+<%=(SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_cumul')/SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_global')*100).round(1)%>+'%</span><br/>' +
                
                '</div>'
        },
        tooltip: {
            valueSuffix: ' %'
        }
    }],
    
});
</script>
<!-- droits constates 2021 -->
<script>
    
    Highcharts.chart('depenses_2021', {
    chart: {
        type: 'solidgauge',
        height: '200px',
          spacingTop: 0,
          style:{
            fontFamily: "Marianne Regular",
          },
    },
    title: {
        text: 'Drois constatés depuis Janvier 2021',
        verticalAlign: "top",
        style: {
                color: "#6A6A6A",
                fontWeight: "400",        
              fontSize: '12px',
                  },
       
    },
    pane: {
        //center: ['50%', '50%'],
        size: '100%',
        startAngle: -90,
        endAngle: 90,
        background: {
            backgroundColor:'#C4C4C4',
            innerRadius: '80%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },

    exporting: {
        enabled: false
    },

    tooltip: {
        enabled: false
    },

    // the value axis
    yAxis: {
        stops: [
            [0.1, '#2323EA'], // green
            [0.5, '#2323EA'], // yellow
            [0.9, '#2323EA'] // red
        ],
        lineWidth: 0,
        tickWidth: 0,
        minorTickInterval: null,
        tickAmount: 2,
        tickPositions: [<%=SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_annee').round(1)%>, <%= SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_annee').round(1) %>],
        min: <%= SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_annee').round(1)%>,
        max: <%= SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_annee').round(1) %>,
        title: {
          text: null,
            y: 100,
        },
        labels: {
            y: 16,
            format: '{value:.0f}M€',
        }
    },

    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: 5,
                borderWidth: 0,
                useHTML: true
            }
        }
    },

    credits: {
        enabled: false
    },
    series: [{
        name: 'Droits constatés',
        data: [<%= SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_annee')+ (SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_annee')/SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_annee'))*(SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_annee')-SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_annee')) %>],
        innerRadius: '80%',
      
        dataLabels: {
          enabled: true,
          y:-40,
            format:
                '<div style="text-align:center;color:#000;">' +
                '<span style="font-size:20px">'+<%=((SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_annee')/SolideoStructureBudget.where('date = ?',SolideoStructureBudget.order(date: :asc).last.date).sum('budget_annee'))*100).round(1)%>+'%</span><br/>' +
               
                '</div>'
        },
        tooltip: {
            valueSuffix: ' %'
        }
    }],
    
});
</script>

<script>

  $('.menu-solideo-depenses').addClass('menu-active2'); 
  $('.menu-solideo').addClass('menu-active'); 

  $('#MonCollapse').addClass('in'); 

</script>

<!-- depenses par annee -->
<script>
  Highcharts.chart('container-bar1', {
    chart: {
        type: 'waterfall',
        height:'200px',
          backgroundColor: '#fff',
          style:{
          fontFamily: "Marianne Regular",
     
          },
    },
    title: {
       text: 'Suivi annuel des dépenses',
       verticalAlign: "top",
        style: {
                  color: "#6A6A6A",
                  fontWeight: "400",
                  fontSize: '12px',
                  },
    },

    xAxis: {
        type: 'category',

    },
    yAxis: {
        min: 0,
        title: {
            text: 'Budget Consommé (M€)'
        },
      gridLineColor: "#fff",
    },
  legend: {
    enabled: false,
  },
    tooltip: {
   
        headerFormat: '<span style="font-size:10px">{point.key}</span><br/>',
        pointFormat: '<b>Dépenses : {point.y:.1f} M€</b><br/>',

        shared: true,
       useHTML: true,
       borderColor: 'transparent',
   borderRadius: 16,
   backgroundColor: '#fff',
    },
    plotOptions: {
      waterfall: {
            pointWidth: 25,
        },
        column: {

            pointPadding: 0.2,
            borderWidth: 0,
            grouping: false,
            pointWidth: 30,
            dataLabels: {
                enabled: true
            }
        }
    },
    series: [{
        borderColor: '#fff',
        data: [{
              name: '2018',
              y: 36.6,
              color: "#2E5D63",
          }, {
              name: '2019',
              y: 92.1,
              color: "#2E5D63",
          },{
              name: '2020',
              y: 228.6,
              color: "#2E5D63",
          },{
              name: '2021',
              y: <%=(SolideoStructureDepense.where('date = ?',SolideoStructureDepense.order(date: :asc).last.date).sum('droits_constates_annee')).round(1)%>,
              color: "#2E5D63",
          }, {
              name: 'Cumul',
              isSum: true,
              color: "#2E5D63"
          }],
          dataLabels: {
              enabled: true,
              inside: false,
                    crop:false,
                    overflow:'allow',
              formatter: function () {
                  return Highcharts.numberFormat(this.y, 0, ',') + 'M€';
              },
            
              style: {
                  fontWeight: 'bold',
                  color: '#000',
              
                fontFamily: 'Karla',
              }
          },
          pointPadding: 0
      }]
});
 </script>

<!-- depenses ouvrages hs --> 
<script>
    
    Highcharts.chart('pie-ouvrages-hs', {
    chart: {
        type: 'solidgauge',
        height: '220px',
          spacingTop: 0,
          style:{
            fontFamily: "Marianne Regular",
          },
    },
    title: {
        text: 'Droits constatés Ouvrages MOA Hors SOLIDEO',
        verticalAlign: "top",
        style: {
                color: "#6A6A6A",
                fontWeight: "400",        
                fontSize: '12px',
                  },     
    },
    pane: {
        //center: ['50%', '50%'],
        size: '100%',
        startAngle: 0,
        endAngle: 360,
        background: {
            backgroundColor:'#C4C4C4',
            innerRadius: '0%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },

    exporting: {
        enabled: false
    },

    tooltip: {
        enabled: true,
        shared: true,
        useHTML: true,
        borderColor: 'transparent',
        borderRadius: 16,
        backgroundColor: '#fff',
    },

    // the value axis
    yAxis: {
        stops: [
            [0.1, '#7D4E5B'], // green
            [0.5, '#7D4E5B'], // yellow
            [0.9, '#7D4E5B'] // red
        ],
        lineWidth: 0,
        tickWidth: 0,
        minorTickInterval: null,
        tickAmount: 2,
        tickPositions: [<%= @droits_constates_moahs.round %>, <%= @budget_moahs%>],
        min: 0,
        max: <%= @budget_moahs.round(1) %>,
        title: {
          text: null,
            y: 100,
        },
        labels: {
            y: 16,
            format: '{value:.0f}M€',
            enabled: false,
        }
    },

    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: -10,
                borderWidth: 0,
                useHTML: true
            }
        }
    },

    credits: {
        enabled: false
    },
    series: [{
        name: 'Paiements versés',
        data: [<%= @droits_constates_moahs.round %>],
        innerRadius: '0%',
        radius: '100%',
        dataLabels: {
          enabled: true,
         
            format:
                '<div style="text-align:center;color:#000;">' +
                '<span style="font-size:20px">'+<%=((@droits_constates_moahs.round(1)/@budget_moahs)*100).round(1)%>+'%</span><br/>' +
                '<span style="font-size:12px;opacity:0.7">'+<%= @droits_constates_moahs.round(1) %>+' M€</span>' +
                '</div>'
        },
        tooltip: {
            pointFormat: '<span style="padding:0">Paiements versés : <b>'+ <%= @droits_constates_moahs.round(1) %>+'M€/'+<%= @budget_moahs.round(1)%>+'M€</b></span>',
            valueSuffix: ' M€'
        }
    }],
    
});
</script>
<!-- depenses ouvrages solideo --> 
<script>
    
    Highcharts.chart('pie-ouvrages', {
    chart: {
        type: 'solidgauge',
        height: '220px',
          spacingTop: 0,
          style:{
            fontFamily: "Marianne Regular",
          },
    },
    title: {
        text: 'Droits constatés Ouvrages MOA SOLIDEO',
        verticalAlign: "top",
        style: {
                color: "#6A6A6A",
                fontWeight: "400",        
                fontSize: '12px',
                  },
       
    },
    pane: {
        //center: ['50%', '50%'],
        size: '100%',
        startAngle: 0,
        endAngle: 360,
        background: {
            backgroundColor:'#C4C4C4',
            innerRadius: '0%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },

    exporting: {
        enabled: false
    },

    tooltip: {
        enabled: true,
        shared: true,
        useHTML: true,
        borderColor: 'transparent',
        borderRadius: 16,
        backgroundColor: '#fff',
    },

    // the value axis
    yAxis: {
        stops: [
            [0.1, '#5770BE'], // green
            [0.5, '#5770BE'], // yellow
            [0.9, '#5770BE'] // red
        ],
        lineWidth: 0,
        tickWidth: 0,
        minorTickInterval: null,
        tickAmount: 0,
        tickPositions: [<%=@droits_constates_moas%>, <%= @budget_moas%>],
        min: 0,
        max: <%= @budget_moas.round(1)%>,
        title: {
          text: null,
            y: 100,
        },
        labels: {
            y: 16,
            format: '{value:.0f}M€',
            enabled: false,
        }
    },

    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: -10,
                borderWidth: 0,
                useHTML: true
            }
        }
    },

    credits: {
        enabled: false
    },
    series: [{
        name: 'Paiements versés',
        data: [<%= @droits_constates_moas.round(1)%>],
        innerRadius: '0%',
      
        dataLabels: {
          enabled: true,
        
            format:
                '<div style="text-align:center;color:#000;">' +
                '<span style="font-size:20px">'+<%=((@droits_constates_moas/@budget_moas)*100).round(1)%>+'%</span><br/>' +
                '<span style="font-size:12px;opacity:0.7">'+<%= @droits_constates_moas.round(1) %>+' M€</span>' +
                '</div>'
        },
        tooltip: {
          pointFormat: '<span style="padding:0">Paiements versés : <b>'+ <%= @droits_constates_moas.round(1) %>+'M€/'+<%=@budget_moas.round(1)%>+'M€</b></span>',
            valueSuffix: ' M€'
        }
    }],
    
});
</script>
<!-- depenses ouvrages hs annee --> 
<script>
    
    Highcharts.chart('pie-ouvrages-hs-annee', {
    chart: {
        type: 'solidgauge',
        height: '220px',
          spacingTop: 0,
          style:{
            fontFamily: "Marianne Regular",
          },
    },
    title: {
        text: 'Droits constatés Ouvrages MOA Hors SOLIDEO 2021',
        verticalAlign: "top",
        style: {
                color: "#6A6A6A",
                fontWeight: "400",        
                fontSize: '12px',
                  },     
    },
    pane: {
        //center: ['50%', '50%'],
        size: '100%',
        startAngle: 0,
        endAngle: 360,
        background: {
            backgroundColor:'#C4C4C4',
            innerRadius: '0%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },

    exporting: {
        enabled: false
    },

    tooltip: {
        enabled: true,
        shared: true,
        useHTML: true,
        borderColor: 'transparent',
        borderRadius: 16,
        backgroundColor: '#fff',
    },

    // the value axis
    yAxis: {
        stops: [
            [0.1, '#7D4E5B'], // green
            [0.5, '#7D4E5B'], // yellow
            [0.9, '#7D4E5B'] // red
        ],
        lineWidth: 0,
        tickWidth: 0,
        minorTickInterval: null,
        tickAmount: 2,
        tickPositions: [<%= @droits_constates_moahs_annee.round %>, <%= @budget_moahs_annee%>],
        min: 0,
        max: <%= @budget_moahs_annee.round(1) %>,
        title: {
          text: null,
            y: 100,
        },
        labels: {
            y: 16,
            format: '{value:.0f}M€',
            enabled: false,
        }
    },

    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: -10,
                borderWidth: 0,
                useHTML: true
            }
        }
    },

    credits: {
        enabled: false
    },
    series: [{
        name: 'Paiements versés',
        data: [<%= @droits_constates_moahs_annee.round %>],
        innerRadius: '0%',
        radius: '100%',
        dataLabels: {
          enabled: true,
         
            format:
                '<div style="text-align:center;color:#000;">' +
                '<span style="font-size:20px">'+<%=((@droits_constates_moahs_annee.round(1)/@budget_moahs_annee)*100).round(1)%>+'%</span><br/>' +
                '<span style="font-size:12px;opacity:0.7">'+<%= @droits_constates_moahs_annee.round(1) %>+' M€</span>' +
                '</div>'
        },
        tooltip: {
            pointFormat: '<span style="padding:0">Paiements versés : <b>'+ <%= @droits_constates_moahs_annee.round(1) %>+'M€/'+<%= @budget_moahs_annee.round(1)%>+'M€</b></span>',
            valueSuffix: ' M€'
        }
    }],
    
});
</script>
<!-- depenses ouvrages solideo annee --> 
<script>
    
    Highcharts.chart('pie-ouvrages-annee', {
    chart: {
        type: 'solidgauge',
        height: '220px',
          spacingTop: 0,
          style:{
            fontFamily: "Marianne Regular",
          },
    },
    title: {
        text: 'Droits constatés Ouvrages MOA SOLIDEO 2021',
        verticalAlign: "top",
        style: {
                color: "#6A6A6A",
                fontWeight: "400",        
                fontSize: '12px',
                  },
       
    },
    pane: {
        //center: ['50%', '50%'],
        size: '100%',
        startAngle: 0,
        endAngle: 360,
        background: {
            backgroundColor:'#C4C4C4',
            innerRadius: '0%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },

    exporting: {
        enabled: false
    },

    tooltip: {
        enabled: true,
        shared: true,
        useHTML: true,
        borderColor: 'transparent',
        borderRadius: 16,
        backgroundColor: '#fff',
    },

    // the value axis
    yAxis: {
        stops: [
            [0.1, '#5770BE'], // green
            [0.5, '#5770BE'], // yellow
            [0.9, '#5770BE'] // red
        ],
        lineWidth: 0,
        tickWidth: 0,
        minorTickInterval: null,
        tickAmount: 0,
        tickPositions: [<%=@droits_constates_moas_annee%>, <%= @budget_moas_annee%>],
        min: 0,
        max: <%= @budget_moas_annee.round(1)%>,
        title: {
          text: null,
            y: 100,
        },
        labels: {
            y: 16,
            format: '{value:.0f}M€',
            enabled: false,
        }
    },

    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: -10,
                borderWidth: 0,
                useHTML: true
            }
        }
    },

    credits: {
        enabled: false
    },
    series: [{
        name: 'Paiements versés',
        data: [<%= @droits_constates_moas_annee.round(1)%>],
        innerRadius: '0%',
      
        dataLabels: {
          enabled: true,
        
            format:
                '<div style="text-align:center;color:#000;">' +
                '<span style="font-size:20px">'+<%=((@droits_constates_moas_annee/@budget_moas_annee)*100).round(1)%>+'%</span><br/>' +
                '<span style="font-size:12px;opacity:0.7">'+<%= @droits_constates_moas_annee.round(1) %>+' M€</span>' +
                '</div>'
        },
        tooltip: {
          pointFormat: '<span style="padding:0">Paiements versés : <b>'+ <%= @droits_constates_moas_annee.round(1) %>+'M€/'+<%=@budget_moas_annee.round(1)%>+'M€</b></span>',
            valueSuffix: ' M€'
        }
    }],
    
});
</script>
<% end %>