<div class="chorus-table-subtitle"><a id="bop-total-ht2-btn">Bilan compte budgétaire HT2</a> <% if !@bop_t2.nil? && @bop_t2.length > 0 %><a id="bop-total-t2-btn">Bilan compte budgétaire T2</a> <% end %></div> 
<div class="ED_table" id="bop-total-ht2">
      <table class="table-striped">
        <thead>
          <tr>
            <th scope="col">Date</th>
              <th scope="col">MADI Réception</th>
              <th scope="col">MADI Envoi</th>
              <th scope="col">REAP Réception</th>
              <th scope="col">REAP Envoi</th>         
          </tr>
        </thead>

        <tbody>
          <% if !@dates.nil?%>
            <% @dates.each do |date| %>
              <tr>
                <td><%= l(Date.new(date.to_i,1,1), format: "%Y") %></td>
               
                  <td><%= number_with_delimiter(@bop_ht2.where('date >= ? AND date <= ? AND type_piece = ? AND operation = ? ',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31),"MADI", "Réception").sum('montant'), :delimiter => ' ') %> €</td>
                <td><%= number_with_delimiter(@bop_ht2.where('date >= ? AND date <= ? AND type_piece = ? AND operation = ? ',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31),"MADI", "Envoyer").sum('montant'), :delimiter => ' ') %> €</td>
                <td><%= number_with_delimiter(@bop_ht2.where('date >= ? AND date <= ? AND type_piece = ? AND operation = ? ',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31),"REAP", "Réception").sum('montant'), :delimiter => ' ') %> €</td>
                <td><%= number_with_delimiter(@bop_ht2.where('date >= ? AND date <= ? AND type_piece = ? AND operation = ? ',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31),"REAP", "Envoyer").sum('montant'), :delimiter => ' ') %> €</td>
              

              </tr>
            <% end %>
         
          <% end %>
        </tbody>
      </table>
      </div>
<% if !@bop_t2.nil? && @bop_t2.length > 0 %>

<div class="ED_table" id="bop-total-t2">
      <table class="table-striped">
        <thead>
          <tr>
            <th scope="col">Date</th>
              <th scope="col">MADI Réception</th>
              <th scope="col">MADI Envoi</th>
              <th scope="col">REAP Réception</th>
              <th scope="col">REAP Envoi</th>         
          </tr>
        </thead>

        <tbody>
          <% if !@dates.nil?%>
            <% @dates.each do |date| %>
              <tr>
                <td><%= l(Date.new(date.to_i,1,1), format: "%Y") %></td>
               
                  <td><%= number_with_delimiter(@bop_t2.where('date >= ? AND date <= ? AND type_piece = ? AND operation = ? ',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31),"MADI", "Réception").sum('montant'), :delimiter => ' ') %> €</td>
                <td><%= number_with_delimiter(@bop_t2.where('date >= ? AND date <= ? AND type_piece = ? AND operation = ? ',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31),"MADI", "Envoyer").sum('montant'), :delimiter => ' ') %> €</td>
                <td><%= number_with_delimiter(@bop_t2.where('date >= ? AND date <= ? AND type_piece = ? AND operation = ? ',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31),"REAP", "Réception").sum('montant'), :delimiter => ' ') %> €</td>
                <td><%= number_with_delimiter(@bop_t2.where('date >= ? AND date <= ? AND type_piece = ? AND operation = ? ',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31),"REAP", "Envoyer").sum('montant'), :delimiter => ' ') %> €</td>
              

              </tr>
            <% end %>
         
          <% end %>
        </tbody>
      </table>
      </div>  
<% end %>

<div class="SD-topo-box-title2"><a href="#details-bop" role="button" data-toggle="collapse" aria-expanded="true" aria-controls="details-bop"> Tableau des mouvements de crédits au niveau du BOP <i class="fas fa-chevron-down"></i></a>
    </div><br>
     <section id="details-bop" class="collapse">
       <div class="chorus-table-subtitle"><a id="details-bop-total-ht2-btn">Détails Mouvements HT2</a> <% if !@bop_t2.nil? && @bop_t2.length > 0 %><a id="details-bop-total-t2-btn">Détails Mouvements T2</a> <% end %></div> 
      <!-- HT2-->
      
      <div class="ED_table" id="details-bop-total-ht2">
        <table class="table-striped">
          <thead>
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Type budget</th>
              <th scope="col">Type piece</th> 
              <th scope="col">Operation</th>
              <th scope="col">Centre financier</th>
              <th scope="col">Compte budgetaire</th>
              <th scope="col">Montant (€)</th>

            </tr>
          </thead>

          <tbody>
            <% @dates.each do |date| %>
            <% @bop_ht2.where('date >= ? AND date <= ?',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31)).each do |choru| %>
              <tr>
                <td><%= l(choru.date, format: "%e %b %Y") %></td>
                <td><%= choru.type_budget %></td>
                <td><%= choru.type_piece %></td>
                <td><%= choru.operation %></td>
                <td><%= choru.centre_financier %></td>
                <td><%= choru.compte_budgetaire %></td>
                <td><%= number_with_delimiter(choru.montant, :delimiter => ' ') %></td>

              </tr>
            <% end %>
            <!-- total annuel -->
            <tr class="total-annuel">
                <td><%= l(Date.new(date.to_i,1,1), format: "%Y") %></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><%= number_with_delimiter(@bop_ht2.where('date >= ? AND date <= ?',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31)).sum('montant'), :delimiter => ' ') %></td>
            </tr><br>
            <% end %>
          </tbody>
        </table>
      </div>
       <!-- T2-->
       <% if !@bop_t2.nil? && @bop_t2.length > 0 %>
      
      <div class="ED_table" id="details-bop-total-t2">
        <table class="table-striped">
          <thead>
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Type budget</th>
              <th scope="col">Type piece</th> 
              <th scope="col">Operation</th>
              <th scope="col">Centre financier</th>
              <th scope="col">Compte budgetaire</th>
              <th scope="col">Montant (€)</th>

            </tr>
          </thead>

          <tbody>
            <% @dates.each do |date| %>
            <% @bop_t2.where('date >= ? AND date <= ?',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31)).each do |choru| %>
              <tr>
                <td><%= l(choru.date, format: "%e %b %Y") %></td>
                <td><%= choru.type_budget %></td>
                <td><%= choru.type_piece %></td>
                <td><%= choru.operation %></td>
                <td><%= choru.centre_financier %></td>
                <td><%= choru.compte_budgetaire %></td>
                <td><%= number_with_delimiter(choru.montant, :delimiter => ' ') %></td>

              </tr>
            <% end %>
            <!-- total annuel -->
            <tr class="total-annuel">
                <td><%= l(Date.new(date.to_i,1,1), format: "%Y") %></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><%= number_with_delimiter(@bop_t2.where('date >= ? AND date <= ?',Date.new(date.to_i,1,1),Date.new(date.to_i,12,31)).sum('montant'), :delimiter => ' ') %></td>
            </tr><br>
            <% end %>
          </tbody>
        </table>
      </div>
       <% end %>
     </section>
    <br>

<script>
$('#bop-total-t2').hide();
$('#bop-total-ht2-btn').addClass('chorus-table-subtitle-active');
$('#bop-total-t2-btn').addClass('chorus-table-subtitle-inactive');
$('#bop-total-t2-btn').click(function () {
  $('#bop-total-t2-btn').removeClass('chorus-table-subtitle-inactive');
  $('#bop-total-t2-btn').addClass('chorus-table-subtitle-active');
  $('#bop-total-ht2-btn').removeClass('chorus-table-subtitle-active');
  $('#bop-total-ht2-btn').addClass('chorus-table-subtitle-inactive');
  $('#bop-total-t2').show();
  $('#bop-total-ht2').hide();
  });
$('#bop-total-ht2-btn').click(function () {
  $('#bop-total-ht2-btn').removeClass('chorus-table-subtitle-inactive');
  $('#bop-total-ht2-btn').addClass('chorus-table-subtitle-active');
  $('#bop-total-t2-btn').removeClass('chorus-table-subtitle-active');
  $('#bop-total-t2-btn').addClass('chorus-table-subtitle-inactive');
  $('#bop-total-t2').hide();
  $('#bop-total-ht2').show();
  });
  $('#details-bop-total-t2').hide();
$('#details-bop-total-ht2-btn').addClass('chorus-table-subtitle-active');
$('#details-bop-total-t2-btn').addClass('chorus-table-subtitle-inactive');
$('#details-bop-total-t2-btn').click(function () {
  $('#details-bop-total-t2-btn').removeClass('chorus-table-subtitle-inactive');
  $('#details-bop-total-t2-btn').addClass('chorus-table-subtitle-active');
  $('#details-bop-total-ht2-btn').removeClass('chorus-table-subtitle-active');
  $('#details-bop-total-ht2-btn').addClass('chorus-table-subtitle-inactive');
  $('#details-bop-total-ht2').hide();
  $('#details-bop-total-t2').show();
  });
$('#details-bop-total-ht2-btn').click(function () {
  $('#details-bop-total-ht2-btn').removeClass('chorus-table-subtitle-inactive');
  $('#details-bop-total-ht2-btn').addClass('chorus-table-subtitle-active');
  $('#details-bop-total-t2-btn').removeClass('chorus-table-subtitle-active');
  $('#details-bop-total-t2-btn').addClass('chorus-table-subtitle-inactive');
  $('#details-bop-total-t2').hide();
  $('#details-bop-total-ht2').show();
  });
</script>