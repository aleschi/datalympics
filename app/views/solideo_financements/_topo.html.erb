
<div class="pd32 br20 bs bckc1">  
  <div><span class="fs16 fw7 pdt c0 bckc2 tupp">Financements de la solideo</span></div>
  <div class="i24"></div>

  <div class="row">
   <div class="col-md-5 col-xs-12">
     <div class="mr10" id="container-bar"></div>
    </div> 
    <div class="col-md-7 col-xs-12">  
      <div id="container-bar1"></div>
      <div class="i60"></div>
      <div id="container-bar2"></div>
    </div>
  </div>  
</div>

<div class="i24"></div>

<div class="pd32 br20 bs bckc1">  
  <div><span class="fs16 fw7 pdt c0 bckc2 tupp">Suivi annuel des financements et recettes de la solideo</span></div>
  <div class="i24"></div>

  <div class="flexslider2" id="flexslider-fin">
    <ul class="slides">
    <% @dates_reporting.each_with_index do |date,i|%>

    <li> 
      <div class="ga ma pr">
        <div class="c2 tc fw8 fs22">Financements reçus cumul <%= l(date, format: "%Y") %> </div>
        <div class='i24'></div>
        <div id="financements<%=i%>"></div>

        <div class="i24"></div>
        <div class="c2 fs14 tc">Pourcentage des versements reçus par rapport au financement total prévu</div>
        <div class="i24"></div>
        <div>
          
            <div class="inline-flex w100">
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','État',date).sum('montant')/SolideoFinancement.where('financeur=?','État').sum('montant')*100).round %>% </div>
                  <div class="box_i1_t2">Etat</div>
              </div>
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','RIF',date).sum('montant')/SolideoFinancement.where('financeur=?','RIF').sum('montant')*100).round %>% </div>
                  <div class="box_i1_t2">IDF</div>
              </div>
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','Métropole Grand Paris',date).sum('montant')/SolideoFinancement.where('financeur=?','Métropole Grand Paris').sum('montant')*100).round %>%</div>
                <div class="box_i1_t2"> MGP</div>
              </div> 
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','Ville de Paris',date).sum('montant')/SolideoFinancement.where('financeur=?','Ville de Paris').sum('montant')*100).round %>% </div>
                <div class="box_i1_t2">Ville de Paris</div>
              </div>   
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','CD93',date).sum('montant')/SolideoFinancement.where('financeur=?','CD93').sum('montant')*100).round(0) %>% </div>
                <div class="box_i1_t2">CD 93</div>
              </div> 
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','EPT Plaine Commune',date).sum('montant')/SolideoFinancement.where('financeur=?','EPT Plaine Commune').sum('montant')*100).round %>% </div>
                <div class="box_i1_t2">Plaine Co</div>
              </div>
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','Privés + recettes',date).sum('montant')/SolideoFinancement.where('financeur=?','Privés + recettes').sum('montant')*100).round %>% </div>
                <div class="box_i1_t2">Recettes</div>
              </div>
            </div>
        </div> 
        <div class="i12"></div>
        <div>
          
            <div class="inline-flex w100">
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','Ville de Marseille',date).sum('montant')/SolideoFinancement.where('financeur=?','Ville de Marseille').sum('montant')*100).round(1)%>% </div>
                  <div class="box_i1_t2"> Marseille</div>
              </div>
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?',"EPT Terres d'envol",date).sum('montant')/SolideoFinancement.where('financeur=?',"EPT Terres d'envol").sum('montant')*100).round(1)%>% </div>
                  <div class="box_i1_t2">Terre d'envol</div>
              </div>
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','CD92',date).sum('montant')/SolideoFinancement.where('financeur=?','CD92').sum('montant')*100).round(1)%>% </div>
                <div class="box_i1_t2">CD92</div>
              </div> 
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','Ville de Dugny',date).sum('montant')/SolideoFinancement.where('financeur=?','Ville de Dugny').sum('montant')*100).round(1)%>% </div>
                <div class="box_i1_t2">Dugny</div>
              </div>   
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','Ville du Bourget',date).sum('montant')/SolideoFinancement.where('financeur=?','Ville du Bourget').sum('montant')*100).round(1)%>% </div>
                <div class="box_i1_t2">Le bourget</div>
              </div> 
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','CASQY',date).sum('montant')/SolideoFinancement.where('financeur=?','CASQY').sum('montant')*100).round(1)%>% </div>
                <div class="box_i1_t2">Casqy</div>
              </div>
              <div class="box_i1">
                  <div class="box_i1_t1"><%= (SolideoFinancement.where('financeur=? AND date <= ?','CD78',date).sum('montant')/SolideoFinancement.where('financeur=?','CD78').sum('montant')*100).round(1)%>% </div>
                <div class="box_i1_t2">CD78</div>
              </div>
            </div>
        </div> 
        <div class="i12"></div>
      </div>
        
      <script>
      Highcharts.chart('financements<%=i%>', {
        chart: {
            type: 'column',
         marginTop:30,
            width: 750,
          backgroundColor: '#fff',
              style:{
              fontFamily: "Marianne Regular",
         
              },
        },
        title: {
            text: null,
            style: {
                      color: "#8F8F8F",
                      fontWeight: "400",
              fontStyle: 'italic',
              fontSize: '16px',
                      },
        },

        xAxis: {
            categories: ["privé + recettes", "Etat", "RIF", "Ville de Paris", "Métropole Grand Paris", "CD92", "CD93", "CD78", "EPT Plaine Commune","EPT Terres d'envol", "Ville de Dugny", "Ville du Bourget", "CASQY", "Ville de Marseille"],
            crosshair: true,
             labels: {
                formatter: function () {
                  if (this.value == "privé + recettes"){
                    return '<span style="color:#E1000F">' + this.value + '</span>'
                  } else {
                    return this.value 
                  }
                },
                useHTML: true,
            },
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Budget Consommé (M€)'
            },
          gridLineColor: "#fff",
        },
        legend: {
          enabled: false,
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><br>',
            pointFormat: '<span style="padding:0">Financements reçus : <b> {point.y:.1f} M€</b></span>',
  
            shared: true,
            useHTML: true,
            borderColor: 'transparent',
            borderRadius: 16,
            backgroundColor: '#fff',
          },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0,
                grouping: false,
              
            }
        },
        series: [{
            name: 'Financements cumulés',
            data: [
              {name: 'privé + recettes', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','Privés + recettes',date).sum('montant')/1000000).round(1)%>, color:"#2E5D63", dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','Privés + recettes',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','Privés + recettes',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: 'Etat', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','État',date).sum('montant')/1000000).round(1)%>, color:"#2E5D63", dataLabels: {
                      enabled: true,
                      inside: false,
                    crop:false,
                    overflow:'allow',
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','État',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','État',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  }, },
              {name: 'RIF', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','RIF',date).sum('montant')/1000000).round(1)%>, color:"#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','RIF',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','RIF',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  }, },
              {name: 'Ville de paris', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','Ville de paris',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','Ville de paris',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','Ville de paris',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: 'Métropole Grand Paris', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','Métropole Grand Paris',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','Métropole Grand Paris',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','Métropole Grand Paris',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: 'CD92', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','CD92',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','CD92',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','CD92',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: 'CD93', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','CD93',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','CD93',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','CD93',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: 'CD78', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','CD78',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','CD78',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','CD978',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: 'EPT Plaine Commune', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','EPT Plaine Commune',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','EPT Plaine Commune',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','EPT Plaine Commune',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: "EPT Terres d'envol", y:<%= (SolideoFinancement.where('financeur=? AND date <= ?',"EPT Terres d'envol",date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?',"EPT Terres d'envol",date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?',"EPT Terres d'envol",date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: 'Ville de Dugny', y: <%= (SolideoFinancement.where('financeur=? AND date <= ?','Ville de Dugny',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','Ville de Dugny',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','Ville de Dugny',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');

                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }

                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name:'Ville du Bourget', y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','Ville du Bourget',date).sum('montant')/1000000).round(1)%>, color: "#bfbfbf",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?','Ville du Bourget',date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?','Ville du Bourget',date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: "CASQY", y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','CASQY',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?',"CASQY",date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?',"CASQY",date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
              {name: "Ville de Marseille", y:<%= (SolideoFinancement.where('financeur=? AND date <= ?','Ville de Marseille',date).sum('montant')/1000000).round(1)%>, color: "#2E5D63",dataLabels: {
                      enabled: true,
                      formatter: function() {

                        var point = this;                      
                        ecart = <%= ((SolideoFinancement.where('financeur=? AND date <= ?',"Ville de Marseille",date).sum('montant')-SolideoFinancement.where('financeur=? AND date <= ?',"Ville de Marseille",date-1.year).sum('montant'))/1000000).round(1)%>;
                        
                        number = Highcharts.numberFormat(point.y, -1, ',',' ');
                        if (ecart > 0){
                          header = '<span style="font-size: 10px;color:#20E37B"> +' + ecart  + '</span><br/>';
                        }else{
                          header = '';
                        }
                          content = '<b>' + number  + ' </b>';

                        return header + content;
                      },
                  },},
            
            
              ],
            pointPlacement: 0,
        }]
      });
      </script> 
    </li>
    <% end %>
    </ul>
  </div>
</div>

<script>
  Highcharts.chart('container-bar1', {
    chart: {
        type: 'column',
    height:'200px',
      backgroundColor: '#fff',
          style:{
          fontFamily: "Marianne Regular",
     
          },
    },
    title: {
       text: 'Suivi annuel des financements',
       verticalAlign: "top",
        style: {
                  color: "#8F8F8F",
                  fontWeight: "400",
    
          fontSize: '12px',
                  },
    },

    xAxis: {
        categories: ['Recu 2018', 'Recu 2019',  "Recu 2020", "Prev 2021", "Cumul"],
        crosshair: true
    },
    yAxis: {
        min: 0,
        title: {
            text: 'Budget financé (M€)'
        },
      gridLineColor: "#fff",
    },
  legend: {
    enabled: false,
  },
    tooltip: {
        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
        pointFormat: '<tr><td style="padding:0"><b>{series.name} : </b></td>' +
            '<td style="padding:0"><b> {point.y:.1f} M€</b></td></tr>',
        footerFormat: '</table>',
        shared: true,
        useHTML: true,
       borderColor: 'transparent',
   borderRadius: 16,
   backgroundColor: '#fff',
    },
    plotOptions: {
        column: {
            pointPadding: 0.2,
            borderWidth: 0,
            grouping: false,
          dataLabels: {
                enabled: true
            }
        }
    },
    series: [{
        name: 'Budget',
        data: [{y:<%= (SolideoFinancement.where('date = ?',Date.new(2018,1,1)).sum('montant')/1000000).round%>, color:"#2E5D63" },{y:<%= (SolideoFinancement.where('date = ?',Date.new(2019,1,1)).sum('montant')/1000000).round%>, color:"#2E5D63" },{y:<%= (SolideoFinancement.where('date = ?',Date.new(2020,1,1)).sum('montant')/1000000).round%>, color: "#2E5D63"},{y:<%= (SolideoFinancement.where('date = ?',Date.new(2021,1,1)).sum('montant')/1000000).round%>, color: "#bfbfbf"},{y:<%= (SolideoFinancement.where('date <= ?',Date.new(2021,1,1)).sum('montant')/1000000).round(1)%>, color: "#bfbfbf"}],
        pointPlacement: 0,
    },{
        name: 'Reçu',
        data: [{y:<%= (SolideoFinancement.where('date = ?',Date.new(2018,1,1)).sum('montant')/1000000).round%>, color:"#2E5D63" },{y:<%= (SolideoFinancement.where('date = ?',Date.new(2019,1,1)).sum('montant')/1000000).round%>, color:"#2E5D63" },{y:<%= (SolideoFinancement.where('date = ?',Date.new(2020,1,1)).sum('montant')/1000000).round%>, color: "#2E5D63"},{y:0, color: "#2E5D63"}, {y: <%= (SolideoFinancement.where('date <= ?',Date.new(2020,1,1)).sum('montant')/1000000).round(1)%>, color: "#C68D7B"}],
        pointPlacement: 0,

    }]
});
 </script>


<script>

  Highcharts.chart('container-bar2', {
    chart: {
        type: 'column',
    height:'200px',
      backgroundColor: '#fff',
          style:{
          fontFamily: "Marianne Regular",
     
          },
    },
    title: {
        text: 'Répartition des financements',
        verticalAlign: "top",
        style: {
                  color: "#8F8F8F",
                  fontWeight: "400",
    
          fontSize: '12px',
                  },
    },

    xAxis: {
        categories: ['Etat', 'Collectivités',  "Privés (compléments)?", "Recettes" ],
        crosshair: true,
        labels: {
                formatter: function () {
                  if (this.value == "Privés (compléments)?"){
                    return '<span style="color:#E1000F;text-align:center;">' + this.value + '</span>'
                  } else {
                    return this.value 
                  }
                },
                useHTML: true,
            },
    },
    yAxis: {
        min: 0,
        title: {
            text: 'Budget (M€)'
        },
      gridLineColor: "#fff",
    },
  legend: {
    enabled: false,
  },
    tooltip: {
        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
        pointFormat: '<tr><td style="padding:0"><b>{series.name} : </b></td>' +
            '<td style="padding:0"><b> {point.y:.1f} M€</b></td></tr>',
        footerFormat: '</table>',
        shared: true,
        useHTML: true,
       borderColor: 'transparent',
   borderRadius: 16,
   backgroundColor: '#fff',
    },
    plotOptions: {
        column: {
            pointPadding: 0.2,
            borderWidth: 0,
            grouping: false,
          dataLabels: {
                enabled: true
            }
        }
    },
    series: [{
        name: 'Budget Total Maquette',
        data: [{y:<%= (SolideoFinancement.where('financeur = ?','État').sum('montant')/1000000).round%>, color:"#bfbfbf" },
        {y:<%=(SolideoFinancement.where('financeur != ? AND financeur != ?','État','Privés + recettes').sum('montant')/1000000).round%>, color:"#bfbfbf" },
        {y:<%=((Maquette.where('date = ?',@dates_maquettes[0]).sum('total') - SolideoFinancement.sum('montant'))/1000000).round%>, color: "#bfbfbf"},
        {y:<%=(SolideoFinancement.where('financeur = ?','Privés + recettes').sum('montant')/1000000).round%>, color: "#bfbfbf"}],
        pointPlacement: 0,
    },{
        name: 'Reçu',
        data: [{y:<%= (SolideoFinancement.where('financeur = ? AND date <= ?','État', Date.new(2020,1,1)).sum('montant')/1000000).round%>, color:"#5770BE" },
        {y:<%=(SolideoFinancement.where('financeur != ? AND financeur != ? AND date <= ?','État','Privés + recettes',Date.new(2020,1,1)).sum('montant')/1000000).round%>, color:"#76505B" },
        {y:0, color: "#FFE800"},
        {y:<%=(SolideoFinancement.where('financeur = ? AND date <= ?','Privés + recettes',Date.new(2020,1,1)).sum('montant')/1000000).round%>, color: "#D08A77"}],
        pointPlacement: 0,

    }]
});
</script>

<script>
 Highcharts.chart('container-bar', {
    chart: {
        type: 'bar',

      style:{
          fontFamily: "Marianne Regular",
         maxWidth: '500px',
          },
    },
    title: {
        text: "Répartition des financements",
        verticalAlign: "top",
        style: {
                  color: "#8F8F8F",
                  fontWeight: "400",
      fontSize: '12px',
                  },
    },
  colors: ['#20E37B'],
    xAxis: {
        categories:  ["État", "Concours Privés", "Région IdF", "Ville de Paris", "CD 93", "Plaine co", "Marseille", "Terre d'envol", "MGP", "CD92", "Dugny", "Le Bourget", "CASQY", "CD78"],
        title: {
            text: null
        }
    },
    yAxis: {
        min: 0,
      gridLineColor: '#fff', 
        title: {
            text: 'Montant (M€)',
            align: 'high'
        },
        labels: {
            overflow: 'justify'
        }
    },
    tooltip: {
        valueSuffix: ' millions',
      borderColor: 'transparent',
   borderRadius: 16,
   backgroundColor: '#fff',
    },
  legend: {
    enabled: false,
  },
    plotOptions: {
        bar: {
            dataLabels: {
                enabled: true
            }
        }
    },
    
    credits: {
        enabled: false
    },
    series: [{
        name: 'Budget',
        data: [{y: <%= (SolideoFinancement.where("financeur = ?", "État").sum('montant')/1000000).round %>, color: "#C68D7B"}, 
        {y: <%= (SolideoFinancement.where("financeur = ?", "Privés + recettes").sum('montant')/1000000).round %>, color: "#2E5D63"}, 
        <%= (SolideoFinancement.where("financeur = ?", "RIF").sum('montant')/1000000).round %>, 
        <%= (SolideoFinancement.where("financeur = ?", "Ville de Paris").sum('montant')/1000000).round %>, 
        <%= (SolideoFinancement.where("financeur = ?", "CD93").sum('montant')/1000000).round %>, 
        <%= (SolideoFinancement.where("financeur = ?", "EPT Plaine Commune").sum('montant')/1000000).round %>,
        <%= (SolideoFinancement.where("financeur = ?", "Ville de Marseille").sum('montant')/1000000).round %>,
        <%= (SolideoFinancement.where("financeur = ?", "EPT Terres d'envol").sum('montant')/1000000).round %>,
        <%= (SolideoFinancement.where("financeur = ?", "Métropole Grand Paris").sum('montant')/1000000).round %>,
        <%= (SolideoFinancement.where("financeur = ?", "CD92").sum('montant')/1000000).round %>,
        <%= (SolideoFinancement.where("financeur = ?", "Ville de Dugny").sum('montant')/1000000).round %>,
        <%= (SolideoFinancement.where("financeur = ?", "Ville du Bourget").sum('montant')/1000000).round %>,
        <%= (SolideoFinancement.where("financeur = ?", "CASQY").sum('montant')/1000000).round %>,
        <%= (SolideoFinancement.where("financeur = ?", "CD78").sum('montant')/1000000).round %>],
     }]
});
  </script>
