<% if !@solideo_financements.nil?%>
<div class="SD-topo-box">
  <div class="SD-topo-box-title">
        <span>Financement de la Solideo</span>
      </div><br><br>
  <div class="budget-topo_chart-box"> 
   
    <div class="budget-topo-chart">
      
    
 
      <div id="container2">
 
      </div>
    </div>
    
  </div>
  <br><br>
</div>
<div class="SD-topo-box">
  
 <div class="SF-topo-financeurs-title"><span>Financeurs de la solideo</span></div><br>
  <div class="SD-topo_chart-box">
   <div class="topo-chart">
    
    <%= pie_chart({"Etat" => @solideo_financements_etat_prevu, "Privés" =>  @solideo_financements_prive_prevu, "Collectivités" => @solideo_financements_collectivites_prevu} ,  library: {
     chart: {
       backgroundColor: '#fff',
    
       style:{
          fontFamily: "Spectral",
          },
    },

      title: {
        text:'<em>Répartition des financements prévus de la Solideo <br> 2018-2025</em>',
        margin:40,
        style: {
          color: '#8F8F8F',
        
          }
      },
  colors: ['#A2C744',"#4F82CE",'#4FC5CE'],
     plotOptions: {
        pie: {
      
          dataLabels: {
                    enabled: true,
                    format: '<em>{point.name}<br>{point.y:,.0f}€ - {point.percentage:.1f} %</em>',
                    style: {
                      color: "#8F8F8F",
                      fontSize: "12px",
                      fontWeight: "400",

                      }
                }
        }
    },
  })
   
    %>

  </div>
 
  <div class="SF-topo-financeurs">
    
   
    <div class="SF-topo-financeurs-box">
      <div class="SF-topo-financeurs-name"></div>
      <div class="SF-topo-financeurs-budget"><div class="SF-topo-financeurs-budget-prevu"><em>Fin. prévus à date €</em></div><div class="SF-topo-financeurs-budget-actuel"> | <em>Fin. actuels €</em></div></div>
    </div> <br><br>
   
   
    <div class="SF-topo-financeurs-box">
      <div class="SF-topo-financeurs-name"><%= link_to etat_budgets_path do %>Etat<%end%></div>
      <div class="SF-topo-financeurs-budget"><div class="SF-topo-financeurs-budget-prevu"><%= number_with_delimiter(@solideo_financements_etat_prevu_date.to_i, :delimiter => ' ')%> €</div><div class="SF-topo-financeurs-budget-actuel"> | <%= number_with_delimiter((@solideo_financements_etat.to_i), :delimiter => ' ') %> € <% if @solideo_financements_etat_prevu_date.to_i > @solideo_financements_etat.to_i %><i class="fas fa-exclamation-circle"></i><%end %></div></div>
    </div>  
    
    <div class="SF-topo-financeurs-box">
      <div class="SF-topo-financeurs-name"><%= link_to collectivites_path do %>Collectivités <%end%></div>
      <div class="SF-topo-financeurs-budget"><div class="SF-topo-financeurs-budget-prevu"><%= number_with_delimiter(@solideo_financements_collectivites_prevu_date.to_i, :delimiter => ' ')%> €</div><div class="SF-topo-financeurs-budget-actuel"> | <%= number_with_delimiter((@solideo_financements_collectivites.to_i), :delimiter => ' ') %> € <% if @solideo_financements_collectivites_prevu_date.to_i > @solideo_financements_collectivites.to_i %><i class="fas fa-exclamation-circle"></i><%end %></div></div>
    </div>
    
    <div class="SF-topo-financeurs-box">
      <div class="SF-topo-financeurs-name">Privés</div>
      <div class="SF-topo-financeurs-budget"><div class="SF-topo-financeurs-budget-prevu"><%= number_with_delimiter(@solideo_financements_prive_prevu_date.to_i, :delimiter => ' ')%> €</div><div class="SF-topo-financeurs-budget-actuel"> | <%= number_with_delimiter((@solideo_financements_prive.to_i), :delimiter => ' ') %> € <% if @solideo_financements_prive_prevu_date.to_i > @solideo_financements_prive.to_i %><i class="fas fa-exclamation-circle"></i><%end %></div></div>
    </div>
   
  
  </div>
  </div>
  
 
</div>
<% end %>


    <script>
  // Uncomment to style it like Apple Watch

function renderIcons() {

    // Move icon
    if (!this.series[0].icon) {
        this.series[0].icon = this.renderer.path(['M', -8, 0, 'L', 8, 0, 'M', 0, -8, 'L', 8, 0, 0, 8])
            .attr({
                stroke: '#303030',
                'stroke-linecap': 'round',
                'stroke-linejoin': 'round',
                'stroke-width': 2,
                zIndex: 10
            })
            .add(this.series[2].group);
    }
    this.series[0].icon.translate(
        this.chartWidth / 2 - 10,
        this.plotHeight / 2 - this.series[0].points[0].shapeArgs.innerR -
            (this.series[0].points[0].shapeArgs.r - this.series[0].points[0].shapeArgs.innerR) / 2
    );

    // Exercise icon
    if (!this.series[1].icon) {
        this.series[1].icon = this.renderer.path(
            ['M', -8, 0, 'L', 8, 0, 'M', 0, -8, 'L', 8, 0, 0, 8,
                'M', 8, -8, 'L', 16, 0, 8, 8]
        )
            .attr({
                stroke: '#ffffff',
                'stroke-linecap': 'round',
                'stroke-linejoin': 'round',
                'stroke-width': 2,
                zIndex: 10
            })
            .add(this.series[2].group);
    }
    this.series[1].icon.translate(
        this.chartWidth / 2 - 10,
        this.plotHeight / 2 - this.series[1].points[0].shapeArgs.innerR -
            (this.series[1].points[0].shapeArgs.r - this.series[1].points[0].shapeArgs.innerR) / 2
    );

    // Stand icon
    if (!this.series[2].icon) {
        this.series[2].icon = this.renderer.path(['M', 0, 8, 'L', 0, -8, 'M', -8, 0, 'L', 0, -8, 8, 0])
            .attr({
                stroke: '#303030',
                'stroke-linecap': 'round',
                'stroke-linejoin': 'round',
                'stroke-width': 2,
                zIndex: 10
            })
            .add(this.series[2].group);
    }

    this.series[2].icon.translate(
        this.chartWidth / 2 - 10,
        this.plotHeight / 2 - this.series[2].points[0].shapeArgs.innerR -
            (this.series[2].points[0].shapeArgs.r - this.series[2].points[0].shapeArgs.innerR) / 2
    );
}


Highcharts.chart('container2', {

    chart: {
      backgroundColor: '#fff',
        type: 'solidgauge',
        maxWidth: '500px',
      height:'300px',
      style:{
          fontFamily: "Spectral",
          },
       events: {
            render: renderIcons
        }
      
    },
 
  title: {
    text: "<em>Financements reçus de la Solideo</em> <br> <em>Financements 2018-2025 prévus : 1 628 520 000€</em>",
    style: {
          color: '#8F8F8F',
        
          }
  },
  tooltip: {
        borderWidth: 0,
        backgroundColor: 'none',
        shadow: false,
        style: {
            fontSize: '12px',
          color: '#8F8F8F',
        },
        //valueSuffix: '€',
        pointFormat: '',
        positioner: function (labelWidth) {
            return {
                x: (this.chart.chartWidth - labelWidth) / 2,
                y: (this.chart.plotHeight / 2) + 35
            };
        }
    },

    pane: {
        startAngle: 0,
        endAngle: 360,
        background: [{ // Track for Move
            outerRadius: '90%',
            innerRadius: '80%',
            backgroundColor: 'rgba(72,175,92,0.3)',
            borderWidth: 0
        }]
    },

    yAxis: {
        min: 0,
        max: 1628520000,
        lineWidth: 0,
        tickPositions: [1628520000],
      tickInterval: 1628520000,
      minorTickInterval: null,
      tickAmount:1,
       labels: {
            step: 1628520000,
            rotation: 'auto',
         style: {
           fontSize: '12px',
          color: '#8F8F8F',
          
         },
         y: -30,
        },
    },

    plotOptions: {
        solidgauge: {
          
          tooltip: "",
          
            dataLabels: {
              enabled: true,
              borderWidth: 0,
              backgroundColor: 'none',
              shadow: false,
              style: {
                  fontSize: '14px',
                color: '#48AF5C',
              },
              valueSuffix: '€',
              format: '<span style="color:#8F8F8F; font-size:12px;font-weight:400">{series.name} :</span><br><span>{point.y:,.0f} €</span>',
            verticalAlign: 'middle',
        
            },
            linecap: 'round',
            stickyTracking: false,
            rounded: true,
         
        }
    },


    series: [{
        name: 'Financements actuels',
        data: [{
            color: '#48AF5C',
            radius: '90%',
            innerRadius: '80%',
            y: <%= @solideo_financements.sum('montant')%>
        }]
    }]
});

  </script>
